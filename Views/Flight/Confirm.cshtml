@model Viman.Models.FlightsBooking
@using Viman.Models
@{
    ViewBag.Title = "Confirm";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.WebsiteURL = Common.WebsiteURL;
    ViewBag.StaticURL = Common.StaticURL;
    ViewBag.Currency = Common.Currency;

    FlightsSearch flightSearch = ViewBag.flightSearch;
    Flights flights = ViewBag.flights;
    DateTime dt1 = DateTime.Now.Date;
}

<style>
    .fltTime-row {
        border-block: 1px dashed #ccc;
        padding: 3px 10px;
    }

    .ConfirmHead {
        background: var(--primary-color);
        text-align: center;
        padding: 10px 20px 0;
        h2

    {
        color: #fff !important;
    }

    }

    .tabledivNew {
        width: 100%;
        th

    {
        width: 150px;
    }

    th, td {
        padding: 0 !important;
        font-family: var(--secondary-font) !important;
        line-height: 2 !important;
        font-size: 15px !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    }

    .FlyDetSec {
        border: 1px solid var(--primary-color);
        border-radius: 5px;
    }

    .CardHead {
        background: var(--primary-color);
        padding: 5px 15px;
        border-radius: 5px 5px 0 0;
    }

        .CardHead p {
            color: #fff;
        }

    .CardBody {
        padding: 15px;
        display: flex;
    }

        .CardBody p {
            font-size: 14px !important;
            line-height: 1.5 !important;
        }

        .CardBody img {
            width: 18px;
        }

    @@media (max-width: 1024px) {
        .grid2 {
            gap: 0 !important;
        }

        br {
            display: none;
        }
    }
</style>

<div class="container Confirm-Booking">
    <div class="ConfirmHead">
        <h2><i class="fa fa-check-circle"></i> Online booking received</h2>
    </div>
    <div class="row">
        <div>
            <div>
                <p><b>Dear, @(Model.FullName)</b></p>
                <p>We have received Your Online booking and it has been sent to the airlines for confirmation purposes.</p>
            </div>
            <br />
            <div class="grid2">
                <div>
                    <p><b>Booking Details</b></p>
                    <table class="tabledivNew">
                        <tr>
                            <th>Booking Id:</th>
                            <td>#@(Model.BookingId)</td>
                        </tr>
                        <tr>
                            <th>Booking Date:</th>
                            <td>@dt1.ToString("dd-MM-yyyy")</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td>Confirmed <i class="fa-solid fa-circle-check" style="color: #006600;"></i></td>
                        </tr>
                    </table>
                </div>
                <div class="tabledivNew">
                    <table>
                        <tr>
                            <th>Flying From:</th>
                            <td>@(@flights.Outbound[0].FromAirport.Code) - @(@flights.Outbound[0].FromAirport.Name)</p>
                        </tr>
                        <tr>
                            <th>Flying To:</th>
                            <td>@(Model.FlightsSearch.To.Code)--@(Model.FlightsSearch.To.Name)</p>
                        </tr>
                        <tr>
                            <th>Depart Date:</th>
                            <td>@(Model.Flights.Outbound[0].DepartureDate.ToString("dd MMM yyyy"))</p>
                        </tr>
                        <tr>
                            @if (flightSearch.FlightWay == FlightWay.RoundTrip)
                            {
                                <th>Return Date: </th>
                            }
                            <td>
                                @if (flightSearch.FlightWay == FlightWay.RoundTrip)
                                {
                                    @(Model.Flights.Inbound[0].DepartureDate.ToString("dd MMM yyyy"))
                                }
                            </td>
                        </tr>
                    </table>
                </div>
                <div>
                    <p><b>Price Summary</b></p>
                    @if (Session["com"] != null && Session["com"] != "")
                    {
                        <table class="tabledivNew">
                            <tr>
                                <td><span><i class="fa fa-male" aria-hidden="true"></i> @(Model.FlightsFare.Adult) X Adult</span></td>
                                <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.AdultFare + Model.FlightsFare.AdultTax + Model.FlightsFare.AdultMarkup) * Model.FlightsFare.Adult)-10).ToString("0.00"))</bdo></td>
                            </tr>
                            @if (Model.FlightsFare.Child > 0)
                            {
                                <tr>
                                    <td><i class="fa fa-child" aria-hidden="true"></i> @(Model.FlightsFare.Child) X Child(ren)</td>
                                    <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.ChildFare + Model.FlightsFare.ChildTax + Model.FlightsFare.ChildMarkup) * Model.FlightsFare.Child)-10).ToString("0.00"))</bdo></td>
                                </tr>
                            }

                            @if (Model.FlightsFare.Infant > 0)
                            {
                                <tr>
                                    <td><span><i class="fa fa-infant" aria-hidden="true"></i> @(Model.FlightsFare.Infant) X Infant(s)</span></td>
                                    <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.InfantFare + Model.FlightsFare.InfantTax + Model.FlightsFare.InfantMarkup) * Model.FlightsFare.Infant)-10).ToString("0.00"))</bdo></td>
                                </tr>
                            }

                            <tr class="travelProtection" style="display:none;">
                                <td><span><i class="fa fa-infant" aria-hidden="true"></i> Travel Protection</span></td>
                                <td> <bdo>@(ViewBag.Currency) 15.95</bdo></td>
                            </tr>

                            <tr>
                                <td>Total</td>
                                <td><bdo id="spCardPrice">@(((Model.FlightsFare.GrandTotal)-10).ToString("0.00"))</bdo></td>
                            </tr>
                        </table>
                    }
                    else
                    {
                        <table class="tabledivNew">
                            <tr>
                                <td><span><i class="fa fa-male" aria-hidden="true"></i> @(Model.FlightsFare.Adult) X Adult</span></td>
                                <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.AdultFare + Model.FlightsFare.AdultTax + Model.FlightsFare.AdultMarkup) * Model.FlightsFare.Adult)).ToString("0.00"))</bdo></td>
                            </tr>
                            @if (Model.FlightsFare.Child > 0)
                            {
                                <tr>
                                    <td><i class="fa fa-child" aria-hidden="true"></i> @(Model.FlightsFare.Child) X Child(ren)</td>
                                    <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.ChildFare + Model.FlightsFare.ChildTax + Model.FlightsFare.ChildMarkup) * Model.FlightsFare.Child)).ToString("0.00"))</bdo></td>
                                </tr>
                            }

                            @if (Model.FlightsFare.Infant > 0)
                            {
                                <tr>
                                    <td><span><i class="fa fa-infant" aria-hidden="true"></i> @(Model.FlightsFare.Infant) X Infant(s)</span></td>
                                    <td><bdo>@(ViewBag.Currency) @((((Model.FlightsFare.InfantFare + Model.FlightsFare.InfantTax + Model.FlightsFare.InfantMarkup) * Model.FlightsFare.Infant)).ToString("0.00"))</bdo></td>
                                </tr>
                            }

                            <tr class="travelProtection" style="display:none;">
                                <td><span><i class="fa fa-infant" aria-hidden="true"></i> Travel Protection</span></td>
                                <td> <bdo>@(ViewBag.Currency) 15.95</bdo></td>
                            </tr>

                            <tr>
                                <td>Total</td>
                                <td><bdo id="spCardPrice">@((Model.FlightsFare.GrandTotal).ToString("0.00"))</bdo></td>
                            </tr>
                        </table>
                    }
                </div>
            </div>
            <br />
            <div class="grid1">
                <div>
                    <table class="tabledivNew">
                        <tr>
                            <th>Passenger Name</th>
                            <th>Gender</th>
                            <th>DOB</th>
                        </tr>
                        @{
                            foreach (PassengerDetail paxItem in Model.PassengerDetail)
                            {
                                <tr>
                                    <td>@paxItem.FirstName</td>
                                    @if (@paxItem.Gender == "1")
                                    {
                                        <td>Male</td>
                                    }
                                    else
                                    {
                                        <td>Female</td>
                                    }
                                    <td>@paxItem.DOB.ToString("dd-MM-yyyy")</td>
                                </tr>
                            }
                        }
                    </table>
                </div>
            </div>
            <br />
            <div class="grid1">
                <div class="FlyDetSec">
                    <div class="CardHead">
                        <p><b>@(@flightSearch.From.Name) <i class="fa fa-long-arrow-right"></i> @(@flightSearch.To.Name)</b>&nbsp;&nbsp;|&nbsp;&nbsp;@(Model.Flights.Outbound[0].CabinClass)&nbsp;&nbsp;|&nbsp;&nbsp;<i class="fa fa-clock-o" aria-hidden="true"></i> Duration : @(Math.Floor(double.Parse(flights.Outbound[flights.Outbound.Count - 1].TotalTime) / 60)):@(double.Parse(flights.Outbound[flights.Outbound.Count - 1].TotalTime) % 60)H</p>
                    </div>
                    @{ int cntOB = 1;
                        foreach (FlightsSegment outboundArr in flights.Outbound)
                        {
                            double stop_time = 0;
                            if (flights.Outbound.Count > 1)
                            {
                                stop_time = double.Parse(Common.GetTime(flights.Outbound[flights.Outbound.Count - 1].DepartureDate, flights.Outbound[flights.Outbound.Count - 2].ArrivalDate) + "");
                            }
                            <div class="CardBody">
                                <div style="flex:1;">
                                    @if (@flights.Airline.Code == "WN")
                                    {

                                        <img src="@(ViewBag.StaticURL + "Content/airline/fit/" + outboundArr.Airline.Code + ".gif")" />

                                    }

                                    else
                                    {
                                        <img src="@("https://images.kiwi.com/airlines/64x64/" + outboundArr.Airline.Code + ".png")" />
                                    }
                                    @*<img src="@(ViewBag.StaticURL + "Content/airline/fit/" + outboundArr.Airline.Code + ".gif")">*@
                                    <p class="fltDetail-code">@(outboundArr.Airline.Code)-@(outboundArr.FlightNo)</p>
                                    <p>@(outboundArr.Airline.Name)</p>
                                </div>
                                <div style="flex:1;">
                                    <p><b>@(outboundArr.FromAirport.Code) - @(outboundArr.ToAirport.Code)</b></p>
                                    <p>@(outboundArr.DepartureDate.ToString("dd-MMM-yy")) - @(outboundArr.ArrivalDate.ToString("dd-MMM-yy"))</p>
                                    <p>@(outboundArr.DepartureDate.ToString("HH:mm")) - @(outboundArr.ArrivalDate.ToString("HH:mm"))</p>
                                </div>
                            </div>
                            if (cntOB < flights.Outbound.Count)
                            {
                                cntOB++;
                                <div class="fltTime-row"> Stop-Over: @(Math.Floor(stop_time / 60)) Hrs. @(Math.Floor(stop_time % 60)) Mins <span class="stopRed">CHANGE OF PLANE REQUIRED.</span></div>
                            }

                        }
                    }
                </div>

                @if (flightSearch.FlightWay == FlightWay.RoundTrip)
                {
                    <div class="FlyDetSec">
                        <div class="CardHead">
                            <p><b>@(@flightSearch.To.Name) <i class="fa fa-long-arrow-right"></i> @(@flightSearch.From.Name)</b>&nbsp;&nbsp;|&nbsp;&nbsp;@(Model.Flights.Inbound[0].CabinClass)&nbsp;&nbsp;|&nbsp;&nbsp;<i class="fa fa-clock-o" aria-hidden="true"></i> Duration :@(Math.Floor(double.Parse(flights.Inbound[flights.Inbound.Count - 1].TotalTime) / 60)):@(double.Parse(flights.Inbound[flights.Inbound.Count - 1].TotalTime) % 60)H</p>
                        </div>
                        @{ int cntIB = 1;
                            foreach (FlightsSegment inboundArr in flights.Inbound)
                            {
                                double stop_time = 0;
                                if (flights.Inbound.Count > 1)
                                {
                                    stop_time = double.Parse(Common.GetTime(flights.Inbound[flights.Inbound.Count - 1].DepartureDate, flights.Inbound[flights.Inbound.Count - 2].ArrivalDate) + "");
                                }
                                <div class="CardBody">
                                    <div style="flex:1;">

                                        @if (@flights.Airline.Code == "WN")
                                        {

                                            <img src="@(ViewBag.StaticURL + "Content/airline/fit/" + inboundArr.Airline.Code + ".gif")" />

                                        }

                                        else
                                        {
                                            <img src="@("https://images.kiwi.com/airlines/64x64/" + inboundArr.Airline.Code + ".png")" />
                                        }

                                        @*<img src="@(ViewBag.StaticURL + "Content/airline/fit/" + inboundArr.Airline.Code + ".gif")">*@
                                        <p class="fltDetail-code">@(inboundArr.Airline.Code)-@(inboundArr.FlightNo)</p>
                                        <p>@(inboundArr.Airline.Name)</p>
                                    </div>
                                    <div style="flex:1;">
                                        <p><b>@(inboundArr.FromAirport.Code) - @(inboundArr.ToAirport.Code)</b></p>
                                        <p>@(inboundArr.DepartureDate.ToString("dd-MMM-yy")) - @(inboundArr.ArrivalDate.ToString("dd-MMM-yy"))</p>
                                        <p>@(inboundArr.DepartureDate.ToString("HH:mm")) - @(inboundArr.ArrivalDate.ToString("HH:mm"))</p>
                                    </div>
                                </div>
                                if (cntIB < flights.Inbound.Count)
                                {
                                    cntIB++;
                                    <div class="fltTime-row"> Stop-Over: @(Math.Floor(stop_time / 60)) Hrs.  @(Math.Floor(stop_time % 60)) Mins <span class="stopRed">CHANGE OF PLANE REQUIRED.</span></div>
                                }
                            }
                        }
                    </div>
                }
            </div>
            <br />
            <div>
                <p>One of our Sales representatives will contact you with an update shortly, alternatively you can give us a call at <strong><a href="tel:+18009183039">+1-800-918-3039</a></strong> or send us an email at <strong><a href="mailto:support@faresmatch.com">support@faresmatch.com</a></strong></p>
                <p>Please find the details of your online booking below (Please note these are not your e tickets)</p>
            </div>
        </div>
    </div>
</div>



<script>
$(document).ready(function () {
    var total = localStorage.getItem("FinalFare");
    var modelTotal = parseFloat("@Model.FlightsFare.GrandTotal.ToString(System.Globalization.CultureInfo.InvariantCulture)");
    var protectionCost = 15.95;


    var totalNum = parseFloat(total);

    if (!isNaN(totalNum) && totalNum > modelTotal) {

        $(".travelProtection").show();
        $("#spCardPrice").text(totalNum.toFixed(2));
        $("#hdnFinalfare").val(totalNum.toFixed(2));
    } else {

        $(".travelProtection").hide();
        $("#spCardPrice").text(modelTotal.toFixed(2));
        $("#hdnFinalfare").val(modelTotal.toFixed(2));
    }
});
</script>

<script>
    window.addEventListener("load", function () {

        const params = new URLSearchParams(window.location.search);
        debugger;
        // Add the new value from Razor model
        //params.set("cnv_cu", "USD");
        params.set("cnv_acf", "@Model.BookingId");
        params.set("cnv_ana", "@Model.PassengerDetail.Count");


        const newUrl = window.location.pathname + "?" + params.toString();

        // Update the URL without reloading the page
        window.history.replaceState({}, "", newUrl);
    });
</script>

<img src="//tag.yieldoptimizer.com/ps/ps?cnv_a=9546&cnv_cpid=7704&t=i&p=9484&cnv_pg=1&cnv_cu=USD&cnv_atf=@((Model.FlightsFare.GrandTotal).ToString("0.00")).&cnv_acf=@Model.BookingId&cnv_aumm=[airline_membership_level]&cnv_aaf=[average_airfare]&cnv_ana=@Model.PassengerDetail.Count&cnv_add=[departure_date]&cnv_ard=[return_date]&cnv_afn=[flight_number]&cnv_adc=[destination_airport_code]&cnv_anm=[airline]&cnv_aoc=[origin_airport_code]&cnv_acc=[cabin_class]&cnv_dateFormat=yyyy-MM-dd" width="1" height="1" alt="" />